---
layout: post_layout
title: 图解HTTP学习笔记之HTTP协议
time: 2016年08月22日 星期一
location: 天津
pulished: true
excerpt_separator: "`请求报文`"
---

## HTTP通信

&#160; &#160; &#160; &#160; HTTP 协议规定，请求从客户端发出，最后服务器端响应该请求并返回。换句话说，肯定是先从客户端开始建立通信的，服务器端在没有接收到请求之前不会发送响应。

<img src="/assets/img/HTTP_Learning/http01.png" alt="图片无法正常显示">

&#160;

&#160; &#160; &#160; &#160; 关于`请求报文`，起始行开头的GET表示请求访问服务器的类型，称为`方法`（method）。随后的字符串 `/index.htm` 指明了请求访问的资源对象，也叫做`请求 URI`（request-URI）。最后的 `HTTP/1.1`，即 HTTP 的版本号，用来提示客户端使用的 HTTP 协议功能。


&#160; &#160; &#160; &#160; 综合来看，这段请求内容的意思是：请求访问某台 HTTP 服务器上的
/index.htm 页面资源。


&#160; &#160; &#160; &#160; `请求报文`是由`请求方法`、`请求 URI`、`协议版本`、`可选的请求首部字段`和`内容实体`构成的。

<img src="/assets/img/HTTP_Learning/http02.png" alt="图片无法正常显示">

&#160; &#160; &#160; &#160;关于`响应报文`，在起始行开头的 `HTTP/1.1` 表示服务器对应的 HTTP 版本。

&#160; &#160; &#160; &#160;紧挨着的 `200 OK` 表示请求的处理结果的`状态码`（status code）和原因短语（reason-phrase）。下一行显示了创建响应的日期时间，是`首部字段`（header field）内的一个属性。

&#160; &#160; &#160; &#160;接着以一空行分隔，之后的内容称为`资源实体的主体`（entity
body）。

&#160; &#160; &#160; &#160;`响应报文`基本上由`协议版本`、`状态码`（表示请求成功或失败的数字代
码）、用以解释状态码的`原因短语`、可选的`响应首部字段`以及`实体主体`构成。

<img src="/assets/img/HTTP_Learning/http03.png" alt="图片无法正常显示">

&#160; 

## HTTP是不保存状态的协议

&#160; &#160; &#160; &#160;HTTP 是一种不保存状态，即`无状态`（stateless）协议。HTTP 协议自
身不对请求和响应之间的通信状态进行保存。也就是说在 HTTP 这个级别，协议对于发送过的请求或响应都不做持久化处理。

&#160; &#160; &#160; &#160;HTTP/1.1 虽然是无状态协议，但为了实现期望的保持状态功能，于是引入了 Cookie 技术。有了 Cookie 再用 HTTP 协议通信，就可以管理状态了。

&#160; &#160; &#160; &#160;假设要求登录认证的 Web 页面本身无法进行状态的管理（不记录已登录的状态），那么每次跳转新页面不是要再次登录，就是要在每次请求报文中附加参数来管理登录状态。

&#160; &#160; &#160; &#160;不可否认，无状态协议当然也有它的优点。由于不必保存状态，自然可减少服务器的 CPU 及内存资源的消耗。从另一侧面来说，也正是因为 HTTP 协议本身是非常简单的，所以才会被应用在各种场景里。

&#160; &#160; &#160; &#160;保留无状态协议这个特征的同时又要解决类似的矛盾问题,于是引入了 Cookie 技术。Cookie 技术通过在请求和响应报文中写入 Cookie 信息来控制客户端的状态。

&#160; &#160; &#160; &#160;Cookie 会根据从服务器端发送的响应报文内的一个叫做 Set-Cookie 的首部字段信息，通知客户端保存 Cookie。当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入 Cookie 值后发送出去。

&#160; &#160; &#160; &#160;服务器端发现客户端发送过来的 Cookie 后，会去检查究竟是从哪一个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息。

### 没有 Cookie 信息状态下的请求

<img src="/assets/img/HTTP_Learning/http04.png" alt="图片无法正常显示">

### 第 2 次以后（存有 Cookie 信息状态）的请求

<img src="/assets/img/HTTP_Learning/http05.png" alt="图片无法正常显示">

<img src="/assets/img/HTTP_Learning/http06.png" alt="图片无法正常显示">


## 告知服务器意图的 HTTP 方法

&#160; &#160; &#160; &#160;HTTP/1.0 和 HTTP/1.1 支持的方法

<img src="/assets/img/HTTP_Learning/http07.png" alt="图片无法正常显示">

&#160; &#160; &#160; &#160;在这里列举的众多方法中，LINK 和 UNLINK 已被 HTTP/1.1 废弃，不
再支持。

## HTTP 报文

报文首部：

<img src="/assets/img/HTTP_Learning/http08.png" alt="图片无法正常显示">

<img src="/assets/img/HTTP_Learning/http09.png" alt="图片无法正常显示">

<img src="/assets/img/HTTP_Learning/http10.png" alt="图片无法正常显示">

&#160; &#160; &#160; &#160;请求报文和响应报文的首部内容由以下数据组成。现在出现的各种首部字段及状态码稍后会进行阐述。


`请求行`    
包含用于请求的方法，请求 URI 和 HTTP 版本。  
`状态行`  
包含表明响应结果的状态码，原因短语和 HTTP 版本。   
`首部字段`  
包含表示请求和响应的各种条件和属性的各类首部。   
一般有 4 种首部，分别是：通用首部、请求首部、响应首部和实体首部。    
`其他`   
可能包含 HTTP 的 RFC 里未定义的首部（Cookie 等）。    


## 返回结果的 HTTP 状态码

<img src="/assets/img/HTTP_Learning/http11.png" alt="图片无法正常显示">


